angular.module("binary",["ionic","pascalprecht.translate","hmTouchEvents","ngIOS9UIWebViewPatch"]),angular.module("binary").run(["$rootScope","$ionicPlatform","$state","alertService","accountService","appStateService","$location",function(e,t,n,o,a,r,i){t.ready(function(){"undefined"!=typeof analytics?analytics.startTrackerWithId("UA-40877026-7"):console.log("Google Analytics Unavailable"),t.registerBackButtonAction(function(){if("options"===n.current.name)o.confirmExit(function(e){1==e&&navigator.app.exitApp()});else if("signin"===n.current.name||"home"===n.current.name)navigator.app.exitApp();else{if("trade"===n.current.name&&r.purchaseMode)return;"trade"!==n.current.name||r.purchaseMode||r.tradeMode?navigator.app.backHistory():(r.tradeMode=!0,e.$$phase||e.$apply())}},100);var i=function(){var e=/#\/redirect\?/.exec(window.location.hash);a.getDefault()||e||n.go("signin")};i(),e.$on("$stateChangeStart",function(e,t,o,r,i){"signin"==t.name||"help"==t.name||"redirect"==t.name||a.getDefault()||(e.preventDefault(),n.go("signin"))})})}]),angular.module("ngIOS9UIWebViewPatch",["ng"]).config(["$provide",function(e){"use strict";e.decorator("$browser",["$delegate","$window",function(e,t){function n(e){return/(iPhone|iPad|iPod).* OS 9_\d/.test(e)&&!/Version\/9\./.test(e)}function o(e){function t(){n=null}var n=null,o=e.url;return e.url=function(){return arguments.length?(n=arguments[0],o.apply(e,arguments)):n||o.apply(e,arguments)},window.addEventListener("popstate",t,!1),window.addEventListener("hashchange",t,!1),e}return n(t.navigator.userAgent)?o(e):e}])}]),angular.module("binary").constant("config",{app_id:"id-ct9oK1jjUNyxvPKYNdqJxuGX7bHvJ",wsUrl:"wss://ws.binaryws.com/websockets/v3?l=",oauthUrl:"https://www.binary.com/oauth2/authorize",tradeCategories:[{name:"Up/Down",markets:["forex","volidx","random"],value:"UP/DOWN"},{name:"Digit Matches/Differs",value:"MATCH/DIFF",markets:["volidx","random"],digits:!0},{name:"Digit Even/Odd",markets:["volidx","random"],value:"EVEN/ODD"},{name:"Digit Over/Under",value:"OVER/UNDER",markets:["volidx","random"],digits:!0}],tradeTypes:[{name:"Up",value:"CALL",digits:!1,category:"UP/DOWN"},{name:"Down",value:"PUT",digits:!1,category:"UP/DOWN"},{name:"Digit Match",value:"DIGITMATCH",digits:!0,category:"MATCH/DIFF"},{name:"Digit Differs",value:"DIGITDIFF",digits:!0,category:"MATCH/DIFF"},{name:"Digit Even",value:"DIGITEVEN",category:"EVEN/ODD"},{name:"Digit Odd",value:"DIGITODD",category:"EVEN/ODD"},{name:"Digit Over",value:"DIGITOVER",digits:!0,category:"OVER/UNDER"},{name:"Digit Under",value:"DIGITUNDER",digits:!0,category:"OVER/UNDER"}],language:"en",assetIndexes:{symbol:0,displayName:1,contracts:2,contractName:0,contractDisplayName:1,contractFrom:2,contractTo:3}}),angular.module("binary").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/home",cache:!1,templateUrl:"templates/pages/home.html",controller:"HomeController"}).state("signin",{url:"/sign-in",cache:!1,templateUrl:"templates/pages/sign-in.html",controller:"SignInController"}).state("help",{url:"/help",templateUrl:"templates/pages/help.html",controller:"HelpController"}).state("trade",{url:"/trade",cache:!1,templateUrl:"templates/pages/trade.html",controller:"TradeController"}).state("options",{url:"/options",cache:!1,templateUrl:"templates/pages/options.html",controller:"OptionsController"}).state("accounts",{url:"/accounts",cache:!1,templateUrl:"templates/pages/accounts.html",controller:"AccountsController"}).state("redirect",{url:"/redirect",cache:!1,templateUrl:"templates/pages/oauth-redirect.template.html",controller:"OAuthRedirect"}),t.otherwise("/home")}]),angular.module("binary").config(["$translateProvider",function(e){var t=localStorage.language||"en";e.preferredLanguage(t),e.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]),angular.module("binary").controller("AccountsController",["$scope","$rootScope","$state","$window","$ionicPopup","websocketService","accountService","alertService","proposalService","appStateService","marketService",function(e,t,n,o,a,r,i,s,c,l,u){"undefined"!=typeof analytics&&analytics.trackView("Account Management"),e.navigateToOptionsPage=function(){n.go("options",{},{reload:!0})},l.invalidTokenRemoved&&(i.validate(),l.invalidTokenRemoved=!1),e.logout=function(){s.confirmRemoveAllAccount(function(t){"boolean"!=typeof t&&(t=1==t?!0:!1),t&&(i.removeAll(),c.remove(),u.removeActiveSymbols(),u.removeAssetIndex(),l.isLoggedin=!1,r.closeConnection(),e.$parent.$broadcast("logout"),n.go("signin"))})}}]),angular.module("binary").controller("BodyController",["$scope","languageService",function(e,t){e.getLanguage=function(){return t.read()}}]),angular.module("binary").controller("HelpController",["$scope","$state","languageService",function(e,t,n){var o=n.read();e.tokenUrl="https://www.binary.com/user/api_tokenws?l="+o.toUpperCase(),"undefined"!=typeof analytics&&analytics.trackView("Help"),e.backToSignInPage=function(){t.go("signin")},e.openExternal=function(e){return window.open(e.currentTarget.href,"_system"),!1}}]),angular.module("binary").controller("HomeController",["$scope","$state","websocketService","accountService",function(e,t,n,o){var a=function(){"undefined"!=typeof analytics&&analytics.trackView("Home"),o.hasDefault()?o.validate():t.go("signin")};a(),e.$on("authorize",function(e,n){n?t.go("options"):t.go("signin")})}]),angular.module("binary").controller("OAuthRedirect",["$scope","$location","$state",function(e,t,n){var o={};o.url=window.location.href,e.close=function(){window.opener.postMessage(o,"*"),window.close()},e.close()}]),angular.module("binary").controller("OptionsController",["$scope","$rootScope","$state","$window","config","proposalService","accountService","websocketService","chartService","delayService","appStateService",function(e,t,n,o,a,r,i,s,c,l,u){function p(){u.isLoggedin?(s.sendRequestFor.symbols(),s.sendRequestFor.assetIndex()):setTimeout(p,500)}function d(){var t=r.get();if(t){e.selected={symbol:t.symbol,tradeType:t.contract_type,tick:t.duration,basis:t.basis,market:t.passthrough.market,digit:t.digit};var n=_.find(a.tradeTypes,["value",t.contract_type]);n&&(e.selected.tradeCategory=n.category),t.barrier&&(e.selected.barrier=t.barrier)}}function f(){return i.checkScope(["READ","TRADE"])}e.selected={},e.isDataLoaded=!1,e.letsTrade=!1,e.hasTradePermission=f(),"undefined"!=typeof analytics&&analytics.trackView("Options"),s.sendRequestFor.forgetAll("ticks"),l.update("symbolsAndAssetIndexUpdate",function(){p()},6e4),d(),e.navigateToManageAccounts=function(){n.go("accounts")},e.navigateToTradePage=function(){n.go("trade")},e.saveChanges=function(){var t={symbol:e.selected.symbol,contract_type:e.selected.tradeType,duration:e.selected.tick,basis:e.selected.basis,currency:i.getDefault().currency,passthrough:{market:e.selected.market},digit:e.selected.digit,barrier:e.selected.barrier};r.update(t)},e.$on("connection:reopened",function(t){e.hasTradePermission=f()}),e.$watch("selected",function(t,n){angular.equals(t,n)||e.saveChanges()},!0),e.setDataLoaded=function(t,n){e.isDataLoaded=t,e.letsTrade=_.isNil(n)?t:n},e.$on("authorize",function(t){e.hasTradePermission=f(),l.update("symbolsAndAssetIndexUpdate",function(){p()},6e4),e.$$phase||e.$apply()})}]),angular.module("binary").controller("SignInController",["$scope","$state","appStateService",function(e,t,n){"undefined"!=typeof analytics&&analytics.trackView("Singin"),n.invalidTokenRemoved=!1,e.navigateToHelpPage=function(){t.go("help")}}]),angular.module("binary").controller("TradeController",["$scope","$state","$ionicSlideBoxDelegate","marketService","proposalService","websocketService","accountService","alertService","appStateService",function(e,t,n,o,a,r,i,s,c){function l(e){if(c.isLoggedin){var t={};t.date_from=(new Date).toISOString().slice(0,10),t.date_to=t.date_from,t.limit=10,t.passthrough={isConnectionReopen:!0},r.sendRequestFor.profitTable(t)}else setTimeout(l,500)}c.waitForProposal=!1,window.addEventListener("native.keyboardhide",function(t){e.hideFooter=!1,e.$apply()}),window.addEventListener("native.keyboardshow",function(t){e.hideFooter=!0,e.$apply()}),e.setTradeMode=function(e){c.tradeMode=e},e.getTradeMode=function(){return c.tradeMode};var u=function(){"undefined"!=typeof analytics&&analytics.trackView("Trade"),e.proposalToSend=JSON.parse(localStorage.proposal),e.setTradeMode(!0),c.purchaseMode=!1,a.getCurrencies()};u(),e.$on("proposal",function(t,n){e.proposalRecieved=n,c.waitForProposal=!1,e.$apply()}),e.$on("currencies",function(t,n){if(n&&n.length>0){e.currency=n[0],e.$apply();var o=a.get();o&&(o.currency=n[0],a.update(o),a.send())}}),r.sendRequestFor.forgetAll("balance"),r.sendRequestFor.balance(),e.$on("balance",function(t,n){e.account=n,e.$apply()}),e.$on("purchase",function(t,n){n.buy?(e.setTradeMode(!1),c.purchaseMode=!0,e.contract={contract_id:n.buy.contract_id,longcode:n.buy.longcode,payout:e.proposalRecieved.payout,cost:n.buy.buy_price,profit:parseFloat(e.proposalRecieved.payout)-parseFloat(n.buy.buy_price),balance:n.buy.balance_after,transaction_id:n.buy.transaction_id},r.sendRequestFor.portfolio(),e.$apply()):n.error?(s.displayError(n.error.message),$(".contract-purchase button").attr("disabled",!1),a.send()):(s.contractError.notAvailable(),$(".contract-purchase button").attr("disabled",!1)),r.sendRequestFor.balance()}),e.$on("purchase:error",function(e,t){$(".contract-purchase button").attr("disabled",!1),c.purchaseMode=!1,a.send()}),e.$on("contract:finished",function(t,n){if(n.exitSpot){"win"===n.result?(e.contract.buyPrice=e.contract.cost,e.contract.profit=e.contract.profit,e.contract.finalPrice=e.contract.buyPrice+e.contract.profit,r.sendRequestFor.openContract()):"lose"===n.result&&(e.contract.buyPrice=e.contract.cost,e.contract.loss=-1*e.contract.cost,e.contract.finalPrice=e.contract.buyPrice+e.contract.loss),e.contract.result=n.result,c.purchaseMode=!1;var o=JSON.parse(localStorage.proposal);if("undefined"!=typeof analytics)analytics.trackEvent(e.account.loginid,o.symbol,o.contract_type,e.proposalRecieved.payout);else{var i={Symbol:o.symbol,TradeType:o.contract_type,Stake:"payout"===o.basis?e.proposalRecieved.ask_price:o.ammount,Market:o.passthrough.market,Duration:o.duration,DurationUnit:o.duration_unit,result:"lose"===n.result?"Lost":"Won"};amplitude.logEvent("Purchase",i)}a.send(),e.$$phase||e.$apply()}}),e.$on("proposal:open-contract",function(e,t){t.is_expired&&r.sendRequestFor.sellExpiredContract()}),e.navigateToOptionsPage=function(e){t.go("options")},e.$on("connection:ready",function(t){i.hasDefault()&&(i.validate(),e.proposalToSend=JSON.parse(localStorage.proposal),a.send(),c.purchaseMode&&l())}),e.$on("profit_table:update",function(t,n,o){if(o.hasOwnProperty("isConnectionReopen")&&o.isConnectionReopen)if(n.count>0){if(c.purchaseMode){var a=_.find(n.transactions,["transaction_id",e.contract.transaction_id]);if(a){var r={};r.exitSpot=!0,r.result=a.sell_price>0?"win":"lose",e.$broadcast("contract:finished",r)}}}else c.purchaseMode=!1,c.tradeMode=!0}),e.isContractFinished=function(){return!c.purchaseMode},e.getWaitForProposal=function(){return c.waitForProposal},e.hasTradePermission=function(){return i.checkScope(["READ","TRADE"])}}]),angular.module("binary").filter("customCurrency",["$filter",function(e){return function(t,n){var o=e("currency");return 0>t?o(t,n).replace("(","-").replace(")",""):o(t,n)}}]),angular.module("binary").service("accountService",["websocketService","appStateService","delayService",function(e,t,n){var o=function(e,t,n){var o=-1;return e.forEach(function(a,r){e[r][t]===n&&(o=r)}),o},a=function(){return localStorage.accounts&&JSON.parse(localStorage.accounts)instanceof Array};this.getAll=function(){return a()?JSON.parse(localStorage.accounts):[]},this.removeAll=function(){localStorage.removeItem("accounts")};var r=function(t,a){if(n.remove("symbolsAndAssetIndexUpdate"),t)e.authenticate(t,a);else{var r=this.getAll(),i=o(r,"is_default",!0);if(i>-1){var s=r[i].token;e.authenticate(s,a)}}};this.validate=function(e,t){if(!e){var n=this.getAll(),a=o(n,"is_default",!0);a>-1&&(e=n[a].token)}r(e,t)},this.add=function(e){var t={id:e.loginid,token:e.token,currency:e.currency||"USD",email:e.email,is_default:!1},n=this.getAll();_.find(n,["id",t.id])||(n.push(t),localStorage.accounts=JSON.stringify(n))},this.remove=function(e){var t=this.getAll(),n=o(t,"token",e);n>-1&&t[n].is_default!==!0&&(t.splice(n,1),localStorage.accounts=JSON.stringify(t))},this.setDefault=function(e){var t=this.getAll(),n=o(t,"token",e);n>-1&&(t.forEach(function(n,o){t[o].is_default=t[o].token===e?!0:!1}),localStorage.accounts=JSON.stringify(t))},this.hasDefault=function(){var e=this.getAll(),t=o(e,"is_default",!0);return t>-1?!0:!1},this.getDefault=function(){var e=this.getAll(),t=o(e,"is_default",!0);return e[t]},this.isUnique=function(e){var t=this.getAll(),n=o(t,"id",e);return n>-1?!1:!0},this.checkScope=function(e){var n=_.concat([],e),o=!1;if(t.isLoggedin&&!_.isEmpty(t.scopes)){o=!0;for(var a in n)if(t.scopes.indexOf(n[a].toLowerCase())<0){o=!1;break}}return o}}]),angular.module("binary").service("alertService",["$translate","$ionicPopup","$rootScope",function(e,t,n){var o=function(e,n){if(void 0===navigator.notification){t.alert({title:e,template:n})}else navigator.notification.alert(n,null,e,"OK")},a=function(e,n,o,a){if(void 0===navigator.notification){var r=t.confirm({title:e,template:n});r.then(a)}else navigator.notification.confirm(n,a,e,o)};this.displayError=function(t){e(["alert.error"]).then(function(e){o(e["alert.error"],t)})},this.displaySymbolWarning=function(t,n){e(["alert.warning",t]).then(function(e){o(e["alert.warning"],e[t])})},this.accountError={tokenNotValid:function(){e(["alert.error","alert.not_valid"]).then(function(e){o(e["alert.error"],e["alert.not_valid"])})},tokenNotAuthenticated:function(){e(["alert.error","alert.not_auth"]).then(function(e){o(e["alert.error"],e["alert.not_auth"])})},tokenNotUnique:function(){e(["alert.error","alert.not_unique"]).then(function(e){o(e["alert.error"],e["alert.not_unique"])})}},this.contractError={notAvailable:function(){e(["alert.error","alert.contract_error"]).then(function(e){o(e["alert.error"],e["alert.contract_error"])})}},this.optionsError={noTick:function(){e(["alert.error","alert.no_tick"]).then(function(e){o(e["alert.error"],e["alert.no_tick"])})}},this.displayAlert=function(e,t){o(e,t)},this.confirmAccountRemoval=function(t){e(["alert.remove_token_title","alert.remove_token_content"]).then(function(e){a(e["alert.remove_token_title"],e["alert.remove_token_content"],["Yes","No"],function(e){"boolean"!=typeof e&&(1==e||(e=!1)),e&&(console.log("You are sure"),n.$broadcast("token:remove",t))})})},this.confirmRemoveAllAccount=function(t){e(["alert.remove_all_tokens_title","alert.remove_all_tokens_content"]).then(function(e){a(e["alert.remove_all_tokens_title"],e["alert.remove_all_tokens_content"],["Yes","No"],t)})},this.confirmExit=function(t){e(["app.exit_title","app.exit_confirmation"]).then(function(e){a(e["app.exit_title"],e["app.exit_confirmation"],["Yes","No"],t)})}}]),angular.module("binary").factory("appStateService",function(){var e={};return e.tradeMode=!0,e.purchaseMode=!1,e.isLoggedin=!1,e.waitForProposal=!1,e.scopes=[],e.invalidTokenRemoved=!1,e}),angular.module("binary").factory("appVersionService",["$http",function(e){function t(){return e.get("js/config.json")}var n={};return n.getAppVersion=t,n}]),angular.module("binary").factory("chartService",["$rootScope",function(e){var t,n,o,a=[],r=function(e){return o.tickCount-1-e},i=function(e){var t=Math.ceil(o.tickCount/o.minTickCount);return r(e)%t===0?!0:!1},s=function(){o={chartJS:null,capacity:600,maxTickCount:50,hideLabelsThreshold:15,tickCount:15,minTickCount:5,chartData:{labels:[],labelsFilter:function(e){return!i(e)},datasets:[{strokeColor:"#e98024",pointColor:"#e98024",pointStrokeColor:"#fff",data:[]}]},chartOptions:{animation:!1,bezierCurve:!1,datasetFill:!1,showTooltips:!1,keepAspectRatio:!1,scaleShowLabels:!1,pointDotRadius:3,datasetStrokeWidth:2}}};s();var c={zeroPad:function(e){return 10>e?"0"+e:e.toString()},getTickTime:function(e){var t=new Date(1e3*e);return t.getUTCHours()+":"+c.zeroPad(t.getUTCMinutes())+":"+c.zeroPad(t.getUTCSeconds())},isDefined:function(e){return"undefined"==typeof e||null===e?!1:!0},setObjValue:function(e,t,n,o){c.isDefined(e)&&(c.isDefined(o)?o&&(e[t]=n):"undefined"==typeof e[t]&&(e[t]=n))},fractionalLength:function(e){var t=e.toString(),n=t.indexOf(".");return t.length-n-1},maxFractionalLength:function(e){var t=0;return e.forEach(function(e){t=t<c.fractionalLength(e)?c.fractionalLength(e):t}),t},lastDigit:function(e){return parseInt(e.toString().slice(-1)[0])},conditions:{CALL:function(e,t){return parseFloat(t)>parseFloat(e)},PUT:function(e,t){return parseFloat(t)<parseFloat(e)},DIGITMATCH:function(e,t){return c.lastDigit(e)===c.lastDigit(t)},DIGITDIFF:function(e,t){return c.lastDigit(e)!==c.lastDigit(t)},DIGITEVEN:function(e,t){return c.lastDigit(t)%2===0},DIGITODD:function(e,t){return c.lastDigit(t)%2!==0},DIGITUNDER:function(e,t){return c.lastDigit(t)<parseInt(e)},DIGITOVER:function(e,t){return c.lastDigit(t)>parseInt(e)}},digitTrade:function(e){return 0===e.type.indexOf("DIGIT")?!0:!1},getRelativeIndex:function(e,t){return e-(n.getCapacity()-(n.getTickCount()+n.getDataIndex()))},getAbsoluteIndex:function(e,t){return e+(n.getCapacity()-(n.getTickCount()+n.getDataIndex()))}},l=function(){var e=0,t=0,n=0,o=!1,a=0,r=function(e,a){t=a,n=e,o=!0},i=function(a,r){return o?n+Math.floor((r-t)/e)-a:0},s=function(t,n){null!==t&&(e=Math.ceil(t.offsetWidth/n))},c=function(){return e},l=function(e,t){return e.timeStamp-a>100?(a=e.timeStamp,!0):!1},u=function(){o=!1};return{isStep:l,stop:u,setDistance:s,getDistance:c,setStartPosition:r,stepCount:i}},u=function(e){var t=[],n=function(e){parseInt(e.epoch)>parseInt(t.slice(-1)[0].time)&&(t.push({time:e.epoch,price:e.quote}),t.shift())},o=function(e,t){var n=t.times,o=t.prices,a=function(e,t){var n=parseInt(e.time),o=parseInt(t.time);return o>n?-1:n>o?1:0},r=[];n.forEach(function(t,n){r.indexOf(t)<0&&(r.push(t),e.push({time:t,price:o[n]}))}),n.sort(a)},a=function(e){t=[],o(t,e)},r=function(n,o,a){var r=e-n,i=r-o;a(i>=0?t.slice(i,r):[])};return{getHistory:r,addTick:n,addHistory:a}},p=function(t){var o=!0,r=function(){return o=!1},i=function(){return c.isDefined(t.exitSpot)},s=function(){return t},l=function(){t.showingEntrySpot=!1,t.showingExitSpot=!1},u=function(){return c.isDefined(t.entrySpotIndex)?!0:!1},p=function(){return c.isDefined(t.exitSpotIndex)?!0:!1},d=function(e){return u()&&e>=t.entrySpotTime&&(!p()||e<=t.exitSpot)?!0:!1},f=function(e){return t.showingEntrySpot&&t.entrySpotIndex===c.getAbsoluteIndex(e)?!0:t.showingExitSpot&&t.exitSpotIndex===c.getAbsoluteIndex(e)?!0:!1},g=function(e){var n;return t.showingEntrySpot&&(n=e[c.getRelativeIndex(t.entrySpotIndex)]),n},h=function(e){var n;return t.showingExitSpot&&(n=e[c.getRelativeIndex(t.exitSpotIndex)]),n},m=function(e){return u()?e===t.entrySpotTime?!0:!1:e>=t.startTime?!0:!1},y=function(e,n){return p()?e===t.exitSpot?!0:!1:u()&&n===t.entrySpotIndex+t.duration?!0:!1},v=function(e,o){m(o)?(t.showingEntrySpot=!0,c.digitTrade(t)||p()||n.addGridLine({color:"#818183",label:"barrier: "+t.barrier,orientation:"horizontal",index:e})):y(o,c.getAbsoluteIndex(e))&&(t.showingExitSpot=!0)},S=function(e,n,o){(m(n)||d(n))&&(m(n)?(c.setObjValue(t,"barrier",o,!c.digitTrade(t)),c.setObjValue(t,"entrySpotTime",n,!u())):y(n,e)&&c.setObjValue(t,"exitSpot",n,!p()),c.setObjValue(t,"entrySpotIndex",e,m(n)),c.setObjValue(t,"exitSpotIndex",e,y(n,e)))},b=function(){if(u()){var e="win"===t.result?"rgba(0, 255, 0, 0.1)":"rgba(255, 0, 0, 0.1)";if(t.showingExitSpot){var o=c.getRelativeIndex(t.entrySpotIndex);o=0>o?0:o,c.isDefined(t.region)?(t.region.color=e,t.region.start=o):t.region={color:e,start:o},t.region.end=c.getRelativeIndex(t.exitSpotIndex),n.addRegion(t.region)}else t.showingEntrySpot?(c.isDefined(t.region)?(t.region.color=e,t.region.start=c.getRelativeIndex(t.entrySpotIndex)):t.region={color:e,start:c.getRelativeIndex(t.entrySpotIndex)},n.addRegion(t.region)):n.removeRegion(t.region)}},k=function(n,s){u()&&d(n)&&(c.conditions[t.type](t.barrier,s)?t.result="win":t.result="lose",i()&&o&&(a.forEach(function(e,n){var o=e.getContract();t===o||e.isFinished()||r()}),o&&e.$broadcast("contract:finished",t)))};return{setNotBroadcastable:r,isFinished:i,getContract:s,isSpot:f,betweenExistingSpots:d,resetSpotShowing:l,addSpots:S,addRegions:k,viewSpots:v,viewRegions:b,getEntrySpotPoint:g,getExitSpotPoint:h}},d=function(){var e,n,i=0,d=!1,f=!1,g=l(),h=function(e){return 0===r(e)?!0:!1},m=function(){return o.tickCount>=o.hideLabelsThreshold?!0:!1},y=function(){return 0===i?!1:!0},v=function(e){var t="black";return!y()&&h(e)&&(t="green"),a.forEach(function(n){n.isSpot(e)&&(t="#818183")}),t},S=function(e,t){var n;return a.forEach(function(t){t.betweenExistingSpots(e)&&(n="#e98024")}),c.isDefined(n)?n:n=h(t)&&!y()?"green":"#e98024"},b=function(e,t){var o,a,r,i=e.scale.endPoint-e.scale.startPoint+12;r=e.datasets[0].points[t.start].x,a=c.isDefined(t.end)?e.datasets[0].points[t.end].x:e.datasets[0].points.slice(-1)[0].x,r>=a||(o=a-r,n.fillStyle=t.color,n.fillRect(r,e.scale.startPoint-12,o,i))},k=function(e,t){return{width:e.measureText(t.value).width,height:parseInt(e.font)}},$=function(e,t){return e.s<t.e&&e.e>t.s||t.s<e.e&&t.e>e.s},w=function(e,t){var o=k(n,e),a=k(n,t),r=$({s:e.y,e:e.y+o.height},{s:t.y,e:t.y+a.height}),i=$({s:e.x,e:e.x+o.width},{s:t.x,e:t.x+a.width});return i&&r},D=function(e){var t=[],n=[];return a.forEach(function(o){var a,r;a=o.getEntrySpotPoint(e),r=o.getExitSpotPoint(e),c.isDefined(a)&&t.push(a),c.isDefined(r)&&n.push(r)}),{entries:t,exits:n}},T=function(e,t){var n=!0;return e.forEach(function(e,o){w(e,t)&&(n=!1)}),n},_=function(e){var t=[],n=D(e);n.exits.forEach(function(e,n){t.push(e)}),n.entries.forEach(function(e,n){T(t,e)&&t.push(e)});var o=e.slice(-1)[0];if(!y()&&T(t,o)&&t.push(o),!m())for(var a=e.length-1;a>=0;a--)T(t,e[a])&&t.push(e[a]);t.forEach(function(e,t){e.shown=!0})},x=function(e,t){if(0!==t&&c.isDefined(e.shown)&&e.shown){n.fillStyle=v(t),n.textAlign="center",n.textBaseline="bottom";var o=0,a=k(n,e).width;h(t)&&(o=45>a?0:a-45),n.fillText(e.value,e.x-o,e.y-1)}},E=function(e,t){var o=e.datasets[0].points[t.index],a=e.scale;if(n.beginPath(),"vertical"===t.orientation)n.moveTo(o.x,a.startPoint+24),n.strokeStyle=t.color,n.fillStyle=t.color,n.lineTo(o.x,a.endPoint),n.stroke(),n.textAlign="center",n.fillText(t.label,o.x,a.startPoint+12);else if("horizontal"===t.orientation){n.moveTo(a.startPoint,o.y),n.strokeStyle=t.color,n.fillStyle=t.color,n.lineTo(e.chart.width,o.y),n.stroke(),n.textAlign="center";var r=n.measureText(t.label).width;n.fillText(t.label,parseInt(r/2)+5,o.y-1)}};Chart.CustomScale=Chart.Scale.extend({initialize:function(){var e=function(e,t,n){e.font=t;var o=0;return Chart.helpers.each(n,function(t){var n=e.measureText(t).width;o=n>o?n:o}),o};this.calculateXLabelRotation=function(){this.ctx.font=this.font;var t=this.ctx.measureText(this.xLabels[this.xLabels.length-1]).width;if(this.xScalePaddingRight=t/2+3,this.xLabelRotation=0,this.display){var n=e(this.ctx,this.font,this.xLabels);this.xLabelWidth=n}else this.xLabelWidth=0,this.xScalePaddingRight=this.padding;this.xScalePaddingLeft=0},Chart.Scale.prototype.initialize.apply(this,arguments)},draw:function(){var e=Chart.helpers,t=e.each,n=e.aliasPixel,o=this.ctx,a=(this.endPoint-this.startPoint)/this.steps,r=Math.round(this.xScalePaddingLeft);this.display&&(o.fillStyle=this.textColor,o.font=this.font,t(this.yLabels,function(t,n){var i=this.endPoint-a*n,s=Math.round(i);o.textAlign="right",o.textBaseline="middle",this.showLabels&&o.fillText(t,r-10,i),o.beginPath(),n>0?(o.lineWidth=this.gridLineWidth,o.strokeStyle=this.gridLineColor):(o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor),s+=e.aliasPixel(o.lineWidth),o.moveTo(r,s),o.lineTo(this.width,s),o.stroke(),o.closePath(),o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor,o.beginPath(),o.moveTo(r-5,s),o.lineTo(r,s),o.stroke(),o.closePath()},this),t(this.xLabels,function(e,t){var a=!1;"function"==typeof this.labelsFilter&&this.labelsFilter(t)&&(a=!0);var r=this.calculateX(t)+n(this.lineWidth),i=this.calculateX(t-(this.offsetGridLines?.5:0))+n(this.lineWidth);o.beginPath(),t>0?(o.lineWidth=this.gridLineWidth,o.strokeStyle=this.gridLineColor):(o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor),o.moveTo(i,this.endPoint),o.lineTo(i,this.startPoint-12),o.stroke(),o.closePath(),o.lineWidth=this.lineWidth,o.strokeStyle=this.lineColor,o.beginPath(),o.moveTo(i,this.endPoint),a?o.lineTo(i,this.endPoint):o.lineTo(i,this.endPoint+5),o.stroke(),o.closePath(),o.save(),o.translate(r,this.endPoint+8),o.textAlign="center",o.textBaseline="top",a||o.fillText(e,0,0),o.restore()},this))}}),Chart.types.Line.extend({name:"LineChartSpots",initialize:function(e){this.options.labelsFilter=e.labelsFilter||null,Chart.types.Line.prototype.initialize.apply(this,arguments)},draw:function(){var e=this.datasets[0],t=this;e.points.forEach(function(e,t){e.fillColor=S(o.chartData.epochLabels[t],t)}),Chart.types.Line.prototype.draw.apply(this,arguments),_(e.points),e.points.forEach(function(e,t){x(e,t)}),c.isDefined(this.options.regions)&&this.options.regions.forEach(function(e){b(t,e)}),c.isDefined(this.options.gridLines)&&this.options.gridLines.forEach(function(e){E(t,e)})},buildScale:function(e){var t=Chart.helpers,n=this,o=function(){var e=[];return n.eachPoints(function(t){e.push(t.value)}),e},a={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,labelsFilter:this.options.labelsFilter,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:e.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(e){var n=t.calculateScaleRange(o(),e,this.fontSize,this.beginAtZero,this.integersOnly);t.extend(this,n)},xLabels:e,font:t.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&t.extend(a,{calculateYRange:t.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new Chart.CustomScale(a)}});var I=function(){o.chartJS.destroy(),s(),e=null,n=null,i=0,d=!1,f=!1,g=null},C=function(t){e=document.getElementById(t),null!==e&&(n=e.getContext("2d"),g=l(),g.setDistance(e,o.tickCount))},O=function(e){return c.isDefined(o.chartOptions.regions)?o.chartOptions.regions.indexOf(e):-1},A=function(e){c.isDefined(o.chartOptions.regions)||(o.chartOptions.regions=[]),O(e)<0&&o.chartOptions.regions.push(e)},P=function(e){var t=O(e);t>=0&&o.chartOptions.regions.splice(t,1)},R=function(e){g.setStartPosition(i,e.center.x),d=!0},L=function(e){f||Y(g.stepCount(i,e.center.x)),g.stop(),d=!1},N=function(){f=!0},F=function(){f=!1},U=function(e){c.isDefined(o.chartOptions.gridLines)||(o.chartOptions.gridLines=[]),o.chartOptions.gridLines.push(e)},M=function(e,t){if(o.chartData.labels=[],o.chartData.epochLabels=e,e.forEach(function(e,t){o.chartData.labels.push(c.getTickTime(e))}),o.chartData.datasets[0].data=t,c.isDefined(o.chartJS)&&o.chartJS.destroy(),c.isDefined(n)){var a=new Chart(n);o.chartJS=a.LineChartSpots(o.chartData,o.chartOptions)}},V=function(e){o.chartOptions.gridLines=[],a.forEach(function(e){e.resetSpotShowing()});var t=[],n=[];e.forEach(function(e,o){var r=parseInt(e.time);a.forEach(function(e){e.viewSpots(o,r)}),t.push(r),n.push(e.price)}),a.forEach(function(e){e.viewRegions()}),M(t,n)},z=function(e){var t,n;e.forEach(function(e,o){var r=parseInt(e.time),i=e.price;a.forEach(function(e){e.addSpots(o,r,i)}),t=parseInt(e.time),n=e.price}),a.forEach(function(e){e.addRegions(t,n)})},W=function(e){c.isDefined(t)&&(t.addTick(e),t.getHistory(0,o.capacity,z),0!==i||d||f?Y(1,!1):t.getHistory(i,o.tickCount,V))},q=function(e){c.isDefined(t)||(t=u(o.capacity)),t.addHistory(e),t.getHistory(0,o.capacity,z),t.getHistory(i,o.tickCount,V)},G=function(e){},J=function(e){},H=function(n){var a,r;if("in"===n)a=parseInt(o.tickCount/1.2),r=a>o.minTickCount;else{if("out"!==n)return;a=parseInt(1.2*o.tickCount),r=a<o.maxTickCount}r&&(o.tickCount=a,t.getHistory(i,o.tickCount,V),g.setDistance(e,o.tickCount))},B=function(){H("out")},j=function(){H("in")},Y=function(e,n){if(0!==e){var a=i+e;0>a?a=0:a>=o.capacity-o.tickCount&&(a=o.capacity-o.tickCount-1),a!==i&&(i=a,(!c.isDefined(n)||n)&&t.getHistory(i,o.tickCount,V))}},K=function(e){!f&&g.isStep(e,o.tickCount)&&Y(g.stepCount(i,e.center.x))},X=function(){return o.capacity},Z=function(){return o.tickCount},Q=function(){return i},ee=function(e){e&&(c.digitTrade(e)&&(e.duration-=1),a.push(p(e)),i=0)},te={addTick:W,addHistory:q,addCandles:G,addOhlc:J};return{dragStart:R,dragEnd:L,zoomIn:j,zoomOut:B,zoomStart:N,zoomEnd:F,dragRight:K,dragLeft:K,getCapacity:X,getTickCount:Z,getDataIndex:Q,addContract:ee,historyInterface:te,addGridLine:U,addRegion:A,removeRegion:P,drawChart:C,destroy:I}},f=function(e){n.drawChart(e)},g=function(){n.destroy(),a.forEach(function(e,t){e.setNotBroadcastable()}),t=null};return n=d(),{destroy:g,drawChart:f,dragStart:n.dragStart,dragEnd:n.dragEnd,zoomIn:n.zoomIn,zoomOut:n.zoomOut,zoomStart:n.zoomStart,zoomEnd:n.zoomEnd,dragRight:n.dragRight,dragLeft:n.dragLeft,getCapacity:n.getCapacity,addContract:n.addContract,historyInterface:n.historyInterface}}]),angular.module("binary").service("cleanupService",["$translate","proposalService",function(e,t){this.run=function(){t.remove()}}]),angular.module("binary").factory("delayService",function(){var e={},t={},n=function(e,n,o){var a=0;return{run:function(r){var i=function(){t[o]=(new Date).getTime(),e.apply(this,n)};0!==r?a=setTimeout(function(){i()},r):i()},cancel:function(){clearTimeout(a)}}};return{update:function(o,a,r,i){var s=(new Date).getTime();if(e.hasOwnProperty(o)){var c=r-(s-t[o]);r=c>0?c:0,e[o].cancel()}else r=0,t[o]=s;e[o]=n(a,i,o),e[o].run(r)},remove:function(n){e.hasOwnProperty(n)&&(e[n].cancel(),delete e[n],delete t[n])}}}),angular.module("binary").service("languageService",["$rootScope","$translate","cleanupService",function(e,t,n){this.update=function(e){localStorage.language=e,this.set(e)},this.set=function(o){if(o)var a=o;else var a=localStorage.language||"en";n.run(),e.$broadcast("language:updated"),t.use(a)},this.read=function(){var e=localStorage.language;return e?e:"en"},this.remove=function(){localStorage.removeItem("language"),n.run()}}]),angular.module("binary").factory("localStorageService",["$state","appStateService",function(e,t){var n={},o=function(e,t,n){var o=-1;return e.forEach(function(a,r){e[r][t]===n&&(o=r)}),o};return n.removeToken=function(e){if(localStorage.hasOwnProperty("accounts")){var t=JSON.parse(localStorage.accounts),n=o(t,"token",e);n>-1&&(t.splice(n),localStorage.accounts=JSON.stringify(t))}},n.getDefaultToken=function(){if(localStorage.accounts&&JSON.parse(localStorage.accounts)instanceof Array){var e=JSON.parse(localStorage.accounts),t=o(e,"is_default",!0);if(t>-1)return e[t].token}return null},n.manageInvalidToken=function(){var o=n.getDefaultToken();o&&n.removeToken(o),localStorage.hasOwnProperty("accounts")?(accounts=JSON.parse(localStorage.accounts),accounts.length?(accounts[0].is_default=!0,localStorage.accounts=JSON.stringify(accounts),
t.invalidTokenRemoved=!0,e.go("accounts")):e.go("signin")):e.go("signin")},n}]),angular.module("binary").service("marketService",["websocketService","proposalService","config",function(e,t,n){var o=function(e){var t={index:["R_100","R_25","R_50","R_75"],BEARBULL:["RDBEAR","RDBULL"],MOONSUN:["RDMOON","RDSUN"],MARSVENUS:["RDMARS","RDVENUS"],YANGYIN:["RDYANG","RDYIN"]},n=[],o=[];return Object.keys(t).forEach(function(a){var r=[],i=-1;e.forEach(function(e,n){e.symbol==t[a][0]&&(i=n)}),0>i||(t[a].forEach(function(n,i){var s=-1;e.forEach(function(e,n){e.symbol==t[a][i]&&(s=n)}),s>=0&&(r.push(e[s]),o.push(s))}),r.sort(),n=n.concat(r))}),e.forEach(function(e,t){o.indexOf(t)<0&&n.push(e)}),n},a=function(e){return e.sort(function(e,t){return e.display_name>t.display_name?1:e.display_name<t.display_name?-1:0}),e=o(e)};this.fixOrder=function(){if(sessionStorage.active_symbols){var e=JSON.parse(sessionStorage.active_symbols);Object.keys(e).forEach(function(t){e[t]=a(e[t])}),sessionStorage.active_symbols=JSON.stringify(e)}},this.getActiveMarkets=function(){if(!sessionStorage.active_symbols||"null"===sessionStorage.active_symbols)return[];var e=JSON.parse(sessionStorage.active_symbols);return e?Object.keys(e):(console.log(e),[])},this.getAllSymbolsForAMarket=function(e){if(!e||!sessionStorage.active_symbols||!sessionStorage.asset_index)return[];var t=JSON.parse(sessionStorage.active_symbols)[e],o=JSON.parse(sessionStorage.asset_index),a=n.assetIndexes,r=[];return t.map(function(e){for(i=0;i<o.length;i++)if(e.symbol===o[i][a.symbol]){for(var t=o[i][a.contracts],n=0;n<t.length;n++)if(-1!==t[n][a.contractFrom].indexOf("t")){r.push(e);break}break}o.splice(i,1)}),r},this.getSymbolDetails=function(t){e.sendRequestFor.contractsForSymbol(t)},this.getDefault={market:function(e){var n=t.get();return n&&n.passthrough&&n.passthrough.market&&e[n.passthrough.market]?n.passthrough.market:_.findKey(e,function(e){return e})},symbol:function(e,n){var o=t.get();return o&&o.passthrough&&o.passthrough.market&&o.symbol&&o.passthrough.market==e?o.symbol:n[0].symbol},tradeType:function(e){if(_.isEmpty(e))return null;var n=t.get(),o=n.contract_type,a=e[0].value;return e.forEach(function(e,t){return e.value==o?void(a=o):void 0}),a},tick:function(){var e=t.get();return e.duration?e.duration:5},digit:function(){var e=t.get();return e.barrier?e.barrier:0},basis:function(){var e=t.get();return e.basis?e.basis:"payout"},amount:function(){var e=t.get();return isNaN(e.amount)?5:e.amount}},this.getTradeTypes=function(e){var t=n.tradeTypes,o=[];return t.forEach(function(t,n){for(var a in e)if(e.hasOwnProperty(a)&&t.value===a){for(var r=!1,i=0;i<e[a].length;i++){var s=e[a][i].min_contract_duration;s&&s.toString().match(/^\d+t$/)&&(r=!0)}r&&o.push(t)}}),o},this.removeActiveSymbols=function(){sessionStorage.active_symbols=null},this.removeAssetIndex=function(){sessionStorage.asset_index=null},this.hasActiveSymobols=function(){return sessionStorage.active_symbols},this.hasAssetIndex=function(){return sessionStorage.asset_index}}]),angular.module("binary").service("proposalService",["websocketService","appStateService",function(e,t){var n=function(e){var t={subscribe:1,proposal:1,symbol:e.symbol,contract_type:e.contract_type,duration:e.duration,basis:e.basis,currency:e.currency||"USD",amount:isNaN(e.amount)||0==e.amount?0:e.amount||5,duration_unit:"t",passthrough:e.passthrough};return["PUT","CALL","DIGITEVEN","DIGITODD"].indexOf(e.contract_type)>-1?(delete e.digit,delete e.barrier):e.digit>=0?t.barrier=e.digit:e.barrier>=0&&(t.barrier=e.barrier),t};this.update=function(e){e&&(localStorage.proposal=JSON.stringify(n(e)))},this.send=function(n){e.sendRequestFor.forgetProposals(),e.sendRequestFor.proposal(JSON.parse(localStorage.proposal)),t.waitForProposal=!0},this.get=function(){return localStorage.proposal?JSON.parse(localStorage.proposal):!1},this.remove=function(){localStorage.removeItem("proposal")},this.getCurrencies=function(){e.sendRequestFor.currencies()}}]),angular.module("binary").factory("websocketService",["$rootScope","localStorageService","alertService","appStateService","$state","config",function(e,t,n,o,a,r){var i="",s=function(e){3===i.readyState?(l(),setTimeout(function(){s(e)},1e3)):1===i.readyState?e():i instanceof WebSocket?setTimeout(function(){s(e)},1e3):(l(),setTimeout(function(){s(e)},1e3))},c=function(e){s(function(){i.send(JSON.stringify(e))})},l=function(n){n=n||!1;var a=localStorage.language||"en";(!i||3===i.readyState||n)&&(i&&0!==i.readyState&&i.close(),i=null,o.isLoggedin=!1,i=new WebSocket(r.wsUrl+a),i.onopen=function(){c({ping:1});var n=t.getDefaultToken();if(n){var o={authorize:n,passthrough:{type:"reopen-connection"}};c(o)}console.log("socket is opened"),e.$broadcast("connection:ready")},i.onmessage=function(e){u(e)},i.onclose=function(t){console.log("socket is closed ",t),l(),console.log("socket is reopened"),o.isLoggedin=!1,e.$broadcast("connection:reopened")},i.onerror=function(t){3==t.target.readyState&&e.$broadcast("connection:error"),o.isLoggedin=!1})};e.$on("language:updated",function(){l(!0)});var u=function(a){var r=JSON.parse(a.data);if(r){r.error&&"InvalidToken"===r.error.code&&t.manageInvalidToken();var i=r.msg_type;switch(i){case"authorize":r.authorize?(r.authorize.token=r.echo_req.authorize,window._trackJs.userId=r.authorize.loginid,o.isLoggedin=!0,o.scopes=r.authorize.scopes,amplitude.setUserId(r.authorize.loginid),e.$broadcast("authorize",r.authorize,r.req_id,r.passthrough)):(r.hasOwnProperty("error")&&"InvalidToken"===r.error.code&&t.removeToken(r.echo_req.authorize),e.$broadcast("authorize",!1),o.isLoggedin=!1);break;case"active_symbols":var s=r.active_symbols,c=_.groupBy(s,"market"),l={};for(var u in c)c.hasOwnProperty(u)&&1==c[u][0].exchange_is_open&&(l[u]=c[u]);sessionStorage.hasOwnProperty("active_symbols")&&sessionStorage.active_symbols==JSON.stringify(l)||(sessionStorage.active_symbols=JSON.stringify(l),e.$broadcast("symbols:updated"));break;case"asset_index":sessionStorage.hasOwnProperty("asset_index")&&sessionStorage.asset_index==JSON.stringify(r.asset_index)||(sessionStorage.asset_index=JSON.stringify(r.asset_index),e.$broadcast("assetIndex:updated"));break;case"payout_currencies":e.$broadcast("currencies",r.payout_currencies);break;case"proposal":r.proposal?e.$broadcast("proposal",r.proposal):r.error&&e.$broadcast("proposal:error",r.error);break;case"contracts_for":var p=(r.echo_req.contracts_for,_.groupBy(r.contracts_for.available,"contract_type"));e.$broadcast("symbol",p);break;case"buy":r.error?(e.$broadcast("purchase:error",r.error),n.displayError(r.error.message)):e.$broadcast("purchase",r);break;case"balance":r.error&&"AlreadySubscribed"===r.error.code||e.$broadcast("balance",r.balance);break;case"tick":e.$broadcast("tick",r);break;case"history":e.$broadcast("history",r);break;case"candles":e.$broadcast("candles",r);break;case"ohlc":e.$broadcast("ohlc",r);break;case"portfolio":e.$broadcast("portfolio",r.portfolio);break;case"profit_table":e.$broadcast("profit_table:update",r.profit_table,r.echo_req.passthrough);break;case"sell_expired":e.$broadcast("sell:expired",r.sell_expired);break;case"proposal_open_contract":e.$broadcast("proposal:open-contract",r.proposal_open_contract)}}},p={};return p.authenticate=function(e,t){t=t,o.isLoggedin=!1;var n={authorize:e};for(key in t)t.hasOwnProperty(key)&&(n[key]=t[key]);c(n)},p.sendRequestFor={symbols:function(){var e={active_symbols:"brief"};c(e)},assetIndex:function(){var e={asset_index:1};c(e)},currencies:function(){var e={payout_currencies:1};c(e)},contractsForSymbol:function(e){var t={contracts_for:e};c(t)},ticksForSymbol:function(e){var t={ticks:e};c(t)},forgetAll:function(e){var t={forget_all:e};c(t)},forgetStream:function(e){var t={forget:e};c(t)},forgetProposals:function(){var e={forget_all:"proposal"};c(e)},forgetTicks:function(){var e={forget_all:"ticks"};c(e)},proposal:function(e){c(e)},purchase:function(e,t){var n={buy:e,price:t||0};c(n)},balance:function(){var e={balance:1,subscribe:1};c(e)},portfolio:function(){var e={portfolio:1};c(e)},profitTable:function(e){var t={profit_table:1};for(key in e)e.hasOwnProperty(key)&&(t[key]=e[key]);c(t)},ticksHistory:function(e){e.ticks_history&&c(e)},openContract:function(e,t){var n={};n.proposal_open_contract=1,e&&(n.contract_id=e);for(key in t)t.hasOwnProperty(key)&&(n[key]=t[key]);c(n)},sellExpiredContract:function(){var e={sell_expired:1};c(e)}},p.closeConnection=function(){i&&i.close()},p}]),angular.module("binary").directive("changeAccount",["accountService","websocketService","$state","appStateService",function(e,t,n,o){return{restrict:"E",templateUrl:"templates/components/accounts/change-account.template.html",link:function(a,r){var i=function(){a.accounts=e.getAll(),a.selectedAccount=e.getDefault().token},s=function(){o.isLoggedin?(t.sendRequestFor.symbols(),t.sendRequestFor.assetIndex()):setTimeout(s,500)};i(),a.updateAccount=function(t){a.setDataLoaded(!1),e.setDefault(t),e.validate(),s()},a.navigateToManageAccounts=function(){n.go("accounts")}}}}]),angular.module("binary").directive("manageAccounts",["accountService","alertService","cleanupService","$state","languageService","marketService","proposalService","appStateService",function(e,t,n,o,a,r,i,s){return{restrict:"E",templateUrl:"templates/components/accounts/manage-accounts.template.html",link:function(n,o){var c=null;n.accounts=e.getAll(),n.$on("authorize",function(o,r,i){n.showSpinner=!1,i===c&&(r?(e.isUnique(r.loginid)?(e.add(r),e.setDefault(r.token),n.accounts=e.getAll(),n.$$phase||n.$apply()):n.settingDefault?n.settingDefault=!1:t.accountError.tokenNotUnique(),a.set()):t.accountError.tokenNotAuthenticated())}),n.$on("token:remove",function(t,o){e.remove(o),n.accounts=e.getAll(),n.$$phase||n.$apply()});var l=function(){i.remove(),r.removeActiveSymbols(),r.removeAssetIndex(),s.isLoggedin=!1};n.addAccount=function(o){c=(new Date).getTime(),n.showSpinner=!1,o&&15===o.length?(n.showSpinner=!0,l(),e.validate(o,{req_id:c})):t.accountError.tokenNotValid()},n.removeAccount=function(e){t.confirmAccountRemoval(e)},n.setAccountAsDefault=function(t){c=(new Date).getTime(),n.settingDefault=!0,l(),e.setDefault(t),e.validate(null,{req_id:c}),n.accounts=e.getAll()}}}}]),angular.module("binary").directive("oauth",["config","websocketService","alertService","accountService","languageService",function(e,t,n,o,r){return{restrict:"E",scope:{},templateUrl:"templates/components/accounts/oauth.template.html",link:function(i,s,c){function l(e){for(var t=/acct\d+=(\w+)&token\d+=(\w{2}-\w{29})/g,n=null,o=[];n=t.exec(e);)o.push({loginid:n[1],token:n[2],email:"",is_default:!1});return o}function u(e){for(var t=/error=(\w+)/g,n=null,o=[];n=t.exec(e);)o.push(n[1]);return o}var p=[],d=function(e){i.showSpinner=!1,e&&32==e.length?(i.showSpinner=!0,t.authenticate(e)):n.accountError.tokenNotValid()};window.onmessage=function(e){e.data&&e.data.url&&(p=l(e.data.url),p.length>0&&d(p[0].token))},i.$on("authorize",function(e,t){if(t)for(a in p)0!=a&&(p[a].email=t.email,o.add(p[a]))}),i.signin=function(){var t=window.open(e.oauthUrl+"?app_id="+e.app_id+"&l="+r.read(),"_blank","location=no,toolbar=no");$(t).on("loadstart",function(e){var n=e.originalEvent.url;return u(n).length>0?void t.close():(p=l(n),void(p&&p.length&&(t.close(),d(p[0].token))))})}}}}]),angular.module("binary").directive("scopeMessage",["accountService","appStateService",function(e,t){return{restrict:"E",scope:{},templateUrl:"templates/components/accounts/scope-message.template.html",link:function(n,o,a){n.showScopeMessage=!1,n.hasTradePermissiond=function(){return t.isLoggedIn?e.checkScope(["READ","TRADE"]):!0},n.$on("authorize",function(t,o){n.$$phase||(n.showScopeMessage=!e.checkScope(["READ","TRADE"]))}),n.$on("logout",function(e){n.showScopeMessage=!1})}}}]),angular.module("binary").directive("signin",["accountService","languageService","websocketService","alertService","$state","$ionicPopup","$compile",function(e,t,n,o,a,r,i){return{restrict:"E",templateUrl:"templates/components/accounts/signin.template.html",link:function(r,i){r.showTokenForm=!1,r.showSignin=!1;var s=function(){r.language=t.read()};s(),r.$on("authorize",function(t,n){r.showSpinner=!1,n?(e.isUnique(n.loginid)&&(e.add(n),e.setDefault(n.token)),r.token="",a.go("options")):o.accountError.tokenNotAuthenticated()}),r.signIn=function(){var e=r.token;r.showSpinner=!1,e&&15===e.length?(r.showSpinner=!0,n.authenticate(e)):o.accountError.tokenNotValid()},r.changeLanguage=function(){t.update(r.language)},r.changeSigninView=function(e){e=e||!1,!r.showSignin&&r.showTokenForm?(r.showTokenForm=!1,r.showSignin=!0):r.showSignin&&!r.showTokenForm&&e?r.showSignin=!1:r.showSigninView&&!r.showTokenForm&&(r.showTokenForm=!0,r.showSignin=!1),r.$$phase||r.$apply()},r.showSigninView=function(){r.showSignin=!0,r.$$phase||r.$apply()}}}}]),angular.module("binary").directive("languageList",["languageService",function(e){return{restrict:"E",scope:{},templateUrl:"templates/components/language/language-list.template.html",link:function(t,n,o,a){t.language=e.read(),t.changeLanguage=function(){e.update(t.language)}}}}]),angular.module("binary").directive("appUpdate",["$ionicPlatform",function(e){return{scope:{},restrict:"E",templateUrl:"templates/components/codepush/app-update.template.html",link:function(t,n,o,a){t.hide=function(){t.isShown=!1,t.showSpinner=!1,t.isDownloading=!1,t.$$phase||t.$root.$$phase||t.$apply()},e.ready(function(){t.isShown=!1,t.showSpinner=!1,t.isDownloading=!0,t.progress=0,window.codePush&&codePush.sync(function(e){switch(t.isShown=!1,t.showSpinner=!1,t.isDownloading=!1,e){case SyncStatus.UPDATE_INSTALLED:t.isShown=!0,t.isDownloading=!1,t.message="update.installed",setTimeout(t.hide,5e3);break;case SyncStatus.UP_TO_DATE:t.message="update.up_to_date",setTimeout(t.hide,5e3);break;case SyncStatus.UPDATE_IGNORED:break;case SyncStatus.ERROR:t.isDownloading=!1,t.message="update.error",setTimeout(t.hide,5e3);break;case SyncStatus.CHECKING_FOR_UPDATE:t.message="update.check_for_update",t.showSpinner=!0;break;case SyncStatus.AWAITING_USER_ACTION:break;case SyncStatus.DOWNLOADING_PACKAGE:t.isShown=!0,t.isDownloading=!0,t.message="update.downloading",setTimeout(t.hide,5e3);break;case SyncStatus.INSTALLING_UPDATE:t.isShown=!0,t.message="installing",t.showSpinner=!0,setTimeout(t.hide,5e3)}t.$$phase||t.$root.$$phase||t.$apply()},{installMode:InstallMode.IMMEDIATE,updateDialog:!0},function(e){t.progress=100*e.receivedBytes/e.totalBytes,t.$$phase||t.$root.$$phase||t.$apply()})})}}}]),angular.module("binary").directive("digitsOption",["marketService",function(e){return{restrict:"E",templateUrl:"templates/components/options/digits.template.html",link:function(t,n,o){t.attrs=o;var a=function r(r){var e=t.digits.indexOf(r);0>e||(t.digits.splice(e,1),t.$parent.selected.digit==r&&(t.$parent.selected.digit=t.digits[0]))};t.digits=[0,1,2,3,4,5,6,7,8,9],t.$parent.selected.digit=e.getDefault.digit(),t.$parent.$watch("hideDigit",function(n){null!=t.$parent&&(t.digits=[0,1,2,3,4,5,6,7,8,9],t.$parent.selected.digit=e.getDefault.digit(),isNaN(n)||a(parseInt(n)))}),t.updateDigit=function(e){t.$parent.selected.digit=e}}}}]),angular.module("binary").directive("marketsOption",["marketService","proposalService","alertService",function(e,t,n){return{restrict:"E",templateUrl:"templates/components/options/markets.template.html",link:function(t,o,a){t.showSymbolWarning=!0;var r=function(o){t.symbols=e.getAllSymbolsForAMarket(o),t.symbols.length>0?(t.$parent.selected.symbol=e.getDefault.symbol(o,t.symbols),e.getSymbolDetails(t.$parent.selected.symbol)):(t.$broadcast("symbol",[]),t.showSymbolWarning&&(t.showSymbolWarning=!1,n.displaySymbolWarning("alert.no_underlying"),t.$watch(function(){return t.$parent.selected.market},function(e,n){e!==n&&(t.showSymbolWarning=!0)}))),t.$$phase||t.$apply()},i=function(){if(e.hasActiveSymobols()&&e.hasAssetIndex())try{e.fixOrder();var n=e.getActiveMarkets();t.market={forex:-1!==n.indexOf("forex")?!0:!1},n.indexOf("volidx")>=0?t.market.volidx=!0:n.indexOf("random")>=0&&(t.market.random=!0),t.$parent.selected.market=e.getDefault.market(t.market),r(t.$parent.selected.market),t.$$phase||t.$apply()}catch(o){console.log(o)}};i(),t.$on("symbols:updated",function(e,t){i()}),t.$on("assetIndex:updated",function(e,t){i()}),t.updateMarket=function(e){t.setDataLoaded(!1),t.$parent.selected.market=e,r(t.$parent.selected.market)},t.getNgDisabled=function(){return a.ngDisabled?t.$eval(a.ngDisabled):!1},t.isRandom=function(){var t=e.getActiveMarkets();return t.indexOf("random")>-1}}}}]),angular.module("binary").directive("payoutStakeOption",["marketService",function(e){return{restrict:"E",templateUrl:"templates/components/options/payout-stake.template.html",link:function(t,n,o){t.$parent.selected.basis=e.getDefault.basis(),t.updateBasis=function(e){t.$parent.selected.basis=e},t.getNgDisabled=function(){return o.ngDisabled?t.$eval(o.ngDisabled):!1}}}}]),angular.module("binary").directive("symbolsOption",["marketService","alertService","config",function(e,t,n){return{restrict:"E",templateUrl:"templates/components/options/symbols.template.html",link:function(t,o,a){t.tradeTypes=n.tradeTypes,t.$on("symbol",function(n,o){_.isEmpty(o)?t.setDataLoaded(!0,!1):(t.tradeTypes=e.getTradeTypes(o),t.$parent.selected.tradeType=e.getDefault.tradeType(t.tradeTypes),t.setDataLoaded(!0)),t.$$phase||t.$apply()}),t.updateSymbol=function(n){t.$parent.selected.symbol=n,e.getSymbolDetails(t.$parent.selected.symbol)},t.getNgDisabled=function(){return a.ngDisabled?t.$eval(a.ngDisabled):!1}}}}]),angular.module("binary").directive("ticksOption",["marketService",function(e){return{restrict:"E",templateUrl:"templates/components/options/ticks.template.html",link:function(t,n,o){t.ticks=[5,6,7,8,9,10],t.$parent.selected.tick=e.getDefault.tick(),t.updateTick=function(e){t.$parent.selected.tick=e},t.getNgDisabled=function(){return o.ngDisabled?t.$eval(o.ngDisabled):!1}}}}]),angular.module("binary").directive("tradeCategory",["marketService","config","$ionicScrollDelegate",function(e,t,n){return{restrict:"E",templateUrl:"templates/components/options/trade-category.template.html",link:function(e,o,a){e.tradeCategories=_.filter(t.tradeCategories,function(t){return t.markets.indexOf(e.$parent.selected.market)>-1}),e.$parent.$watch("scope.tradeTypes",function(n,o){var a=Object.keys(_.groupBy(n,"category"));e.tradeCategories=_.filter(t.tradeCategories,function(e){return a.indexOf(e.value)})}),e.$parent.$watch("selected",function(n){if(n.tradeType){var o=_.find(t.tradeTypes,["value",n.tradeType]);e.updateTradeType(o.category)}e.tradeCategories=_.filter(t.tradeCategories,function(t){return t.markets.indexOf(e.$parent.selected.market)>-1})},!0),e.updateTradeType=function(n){var o=_.find(t.tradeTypes,["category",n]);e.$parent.selected.tradeType=o.value,e.$parent.selected.tradeCategory=n,e.$parent.displayDigits=!1,e.$parent.hideDigit="",o.digits===!0&&("OVER/UNDER"==n&&(9==e.$parent.selected.digit?e.$parent.selected.tradeType="DIGITUNDER":e.$parent.selected.tradeType="DIGITOVER"),e.$parent.displayDigits=!0,e.$parent.selected.barrier||e.$parent.selected.digit||(e.$parent.selected.digit=0))},e.getNgDisabled=function(){return a.ngDisabled?e.$eval(a.ngDisabled):!1},e.$parent.$watch(function(){var e=angular.element(document).find("digits-option").hasClass("ng-hide");return e},function(){n.resize()},!1)}}}]),angular.module("binary").directive("contractSummary",["websocketService",function(e){return{restrict:"E",templateUrl:"templates/components/trades/contract-summary.template.html",link:function(e,t){e.basis=e.$parent.proposalToSend.basis||"payout",e.backToOptionPage=function(){$(".contract-purchase button").attr("disabled",!1),e.setTradeMode(!0)}}}}]),angular.module("binary").directive("longCode",["websocketService",function(e){return{restrict:"E",templateUrl:"templates/components/trades/longcode.template.html",link:function(e,t){e.$parent.$watch("proposalRecieved",function(t){e.longcode=t?t.longcode:""})}}}]),angular.module("binary").directive("payout",["websocketService","marketService","proposalService","delayService","appStateService",function(e,t,n,o,a){return{restrict:"E",templateUrl:"templates/components/trades/payout.template.html",link:function(e,r){function i(){var t=n.get();t&&(t.amount=parseFloat(e.amount,10),n.update(t),n.send(e.proposal&&e.proposal.id?e.proposal.id:null))}var s=1e3;e.basis=e.$parent.proposalToSend.basis||"payout",e.amount=t.getDefault.amount(),0==e.amount&&(e.amount=5,i()),e.proposalError=null,n.send(),e.$on("$destroy",function(){o.remove("updateProposal")}),e.$parent.$watch("proposalRecieved",function(t){if(t){var n=parseFloat(t.payout)-parseFloat(t.ask_price);t.netProfit=isNaN(n)||0>n?"0":n.toFixed(2),e.proposal=t,e.proposalError=null,e.$parent&&e.$parent.purchaseFrom&&e.$parent.purchaseFrom.amount.$setValidity("InvalidAmount",!0),e.$$phase||e.$apply()}}),e.$on("purchase:error",function(t,n){e.$parent.purchaseFrom&&e.$parent.purchaseFrom.amount.$setValidity("InvalidAmount",!1),e.$$phase||e.$apply()}),e.$on("proposal:error",function(t,n){e.proposalError=n,e.$parent.purchaseFrom&&e.$parent.purchaseFrom.amount.$setValidity("InvalidAmount",!1),e.$$phase||e.$apply()}),e.delayedUpdateProposal=function(){a.waitForProposal=!0,e.$$phase||e.$apply(),o.update("updateProposal",i,s)},e.updateAmount=function(t){e.delayedUpdateProposal()},e.addAmount=function(){var t=parseFloat(e.amount);isNaN(t)&&(t=0),e.amount=1e5>t?Number(t+1).toFixed(2):1e5},e.subtractAmount=function(){var t=parseFloat(e.amount);e.amount=t>2?Number(t-1).toFixed(2):1},e.isObjectEmpty=function(e){return _.isEmpty(e)}}}}]),angular.module("binary").directive("purchase",["websocketService","alertService","$rootScope","appStateService",function(e,t,n,o){return{restrict:"E",templateUrl:"templates/components/trades/purchase.template.html",link:function(t,n,a){t.attrs=a,t.title=a.title?a.title:"trade.buy",t.purchase=function(){$(".contract-purchase button").attr("disabled",!0),o.purchaseMode=!0,e.sendRequestFor.purchase(t.$parent.proposalRecieved.id,t.$parent.proposalRecieved.ask_price)},t.getNgDisabled=function(){return t.attrs.ngDisabled?t.$eval(t.attrs.ngDisabled):!1}}}}]),angular.module("binary").directive("tradeContractChart",["websocketService","chartService",function(e,t){return{restrict:"E",templateUrl:"templates/components/trades/trade-contract-chart.template.html",link:function(n,o){var a=function(){var o=n.$parent.proposalToSend.symbol;e.sendRequestFor.forgetTicks(),e.sendRequestFor.ticksHistory({ticks_history:o,end:"latest",count:t.getCapacity(),subscribe:1})},r=function(){var e="tradeContractChart";t.drawChart(e),n.$parent.chartDragLeft=t.dragLeft,n.$parent.chartDragRight=t.dragRight,n.$parent.chartTouch=t.dragStart,n.$parent.chartRelease=t.dragEnd,n.$parent.chartPinchIn=t.zoomOut,n.$parent.chartPinchOut=t.zoomIn,n.$parent.chartPinchStart=t.zoomStart,n.$parent.chartPinchEnd=t.zoomEnd,a()};r(),n.$on("$destroy",function(e,n){t.destroy()}),n.$on("portfolio",function(e,o){var a=n.$parent.contract.contract_id;"undefined"!=typeof a&&o.contracts.forEach(function(e){e.contract_id==a&&t.addContract({startTime:e.date_start+1,duration:parseInt(n.$parent.proposalToSend.duration),type:e.contract_type,barrier:n.$parent.proposalToSend.barrier})})}),n.$on("tick",function(o,a){a&&a.echo_req.ticks_history===n.$parent.proposalToSend.symbol?t.historyInterface.addTick(a.tick):e.sendRequestFor.forgetStream(a.tick.id)}),n.$on("history",function(e,o){o&&o.echo_req.ticks_history===n.$parent.proposalToSend.symbol&&t.historyInterface.addHistory(o.history)}),n.$on("candles",function(e,n){n&&t.historyInterface.addCandles(n.candles)}),n.$on("ohlc",function(e,n){n&&t.historyInterface.addOhlc(n.ohlc)}),n.$on("connection:ready",function(e){a()})}}}]),angular.module("binary").directive("tradeType",["config","proposalService",function(e,t){return{restrict:"E",templateUrl:"templates/components/trades/trade-type.template.html",scope:{proposal:"="},link:function(n,o){function a(){n.tradeCategory=_.find(e.tradeTypes,["value",n.proposal.contract_type]).category,n.tradeTypes=_.filter(e.tradeTypes,["category",n.tradeCategory])}function r(e){n.proposal=t.get(),n.proposal&&(n.proposal.contract_type=e,t.update(n.proposal),t.send(n.proposal&&n.proposal.id?n.proposal.id:null))}n.changeTradeType=function(){r(n.proposal.contract_type)},n.checkDigitsConditions=function(e){return"DIGITOVER"===e&&9==n.proposal.barrier?!0:"DIGITUNDER"===e&&0==n.proposal.barrier?!0:!1},a()}}}]),angular.module("binary").directive("appVersion",["$ionicPlatform","appVersionService",function(e,t){return{scope:{"class":"@"},restrict:"E",templateUrl:"templates/components/utils/app-version.template.html",link:function(n){e.ready(function(){window.cordova?cordova.getAppVersion(function(e){n.appVersion=e},function(e){console.log(e)}):t.getAppVersion().success(function(e){n.appVersion=e.version}).error(function(e){n.appVersion="0.0.0"})})}}}]),angular.module("binary").directive("connectionStatus",function(){return{scope:{},restrict:"E",templateUrl:"templates/components/utils/connection-status.template.html",link:function(e,t,n,o){e.isConnectionError=!1,e.$on("connection:error",function(){e.isConnectionError=!0,e.$$phase||e.$apply()}),e.$on("connection:ready",function(){e.isConnectionError=!1,e.$$phase||e.$apply()})}}}),angular.module("binary").directive("logoSpinner",function(){return{restrict:"E",replace:!0,scope:{start:"="},templateUrl:"templates/components/utils/logo-spinner.template.html"}}),angular.module("binary").directive("onLongPress",["$timeout","$interval",function(e,t){return{restrict:"A",link:function(n,o,a){var r=0,i=a.interval?Number(a.interval):300,s=function(o){n.longPress=!0,a.repetitive&&"true"===a.repetitive?(n.$eval(a.onLongPress),r=t(function(){n.longPress&&n.$eval(a.onLongPress)},i)):r=e(function(){n.longPress&&n.$eval(a.onLongPress)},i)},c=function(o){n.longPress=!1,a.repetitive&&"true"===a.repetitive?t.cancel(r):e.cancel(r),r=void 0,a.onTouchEnd&&n.$apply(function(){n.$eval(a.onTouchEnd)})};o.bind("touchstart",s),o.bind("touchend",c),o.bind("mousedown",s),o.bind("mouseup",c)}}}]),angular.module("binary").directive("stringToNumber",function(){return{require:"ngModel",link:function(e,t,n,o){o.$parsers.push(function(e){return""+parseFloat(parseFloat(e).toFixed(2))}),o.$formatters.push(function(e){return parseFloat(e,10)}),e.$watch(function(){return o.$viewValue},function(e){var t=e.split(".");t.length>1&&t[1].length>2&&(o.$viewValue=t[0]+"."+t[1].slice(0,2),o.$render())})}}});